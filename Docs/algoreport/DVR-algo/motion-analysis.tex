%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Анализ прямоугольников движения {\small\rm (\emph{А.Болтнев})}}
\label{sec:motionanalysis}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
{
\begin{enumerate}\advance\leftskip by -1em
\item На каждом кадре выбирается $K$ (сейчас $K=3$) самых больших
прямоугольника (по площади). Затем каждый их этих К больших
прямоугольников объединяется с оставшимися маленькими
прямоугольниками, пересекающимися с ним(под объединением понимается
минимальный прямоугольник, содержащий данные). Затем маленькие
прямоугольники отбрасываются. Данная процедура позволяет
сосредоточить внимание на самом мощном движении.

\item Из потока прямоугольников формируются \emph{события движения}.
Событие движения может быть открытым или закрытым. Оно состоит из
времени начала движения, времени конца движения и некоторых
прямоугольников, характеризующих движение. Прямоугольники содержат
время своего создания, с точностью 1 секунда (все используют
зачем-то time\_t). Координаты прямоугольников представлены в формате
с плавающей запятой, состоят из чисел от 0 до 1 (в долях размера
кадра).

 Событие движения соответствует своей камере.

 Как только поступают рамки движения, открывается событие движения.
 Оно существует открытым, пока движение не прервется на
 \textsf{TMaxPause}
 секунд (задается в параметрах, сейчас равно 1с).
 Событие может существовать лишь конечное время  \textsf{TMaxLife} (задается в параметрах, сейчас равно 7с.)
Если же движение прерывается или существует слишком долго, то оно
становится закрытым и данные о нем сохраняются в базе данных. Это
является аналогом аларма в Orwell. На данный момент эта часть
алгоритма используется слабо (в поток пишут все подряд рамки). По
началу она использовалась более активно, но в какой-то момент
перестали писать рамки в базу данных и стали писать их прямо в видео
последовательность.

\item \emph{Короткой вспышкой} считается закрытое событие, все рамки
которого имеют одно и то же время. Во времена когда видео было
совсем неустойчивым (пропадали или прыгали с камеры на камеру кадры,
иногда появлялись огромные полосы) короткие вспышки были некоторым
шагом к решению проблемы. Сейчас можно от этого отказаться, но пока
такие события не выводятся наружу.

О том какие рамки содержит событие движения.

Событие движения содержит не все рамки, поступающие с каждой камеры.
Если камер немного и фреймрейт достаточно выскокий, их может
оказаться достаточно много (сейчас до $K=3$ рамок с каждого кадра,
см. выше). Время в системе дискретизировано с точностью до 1
секунды. Это достаточно большое время, поэтому естественно
отбрасывать лишние рамки в каждом периоде дискретизациии.

Сейчас отбрасывание происходит следующим способом. Рамки сортируются
по площади. Затем, начиная с самой большой рамки, смотрится, как она
пересекается с остальными, попавшими в  тот же период дискретизации
времени (1 сек). Если пересечение занимает достаточно много (сейчас
этот параметр равен 50 процентов) от большей рамки, то она
заменяется на более новую меньшую (объект немного сместился). В
противном случае, меньшая рамка удаляется, при условии что она
попала в пересечение более чем на 50 процентов.



\end{enumerate}

}
